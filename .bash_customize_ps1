#!/bin/bash

# Symboles
export GIT_BRANCH=$'\U000E0A0'

# See: https://www.ditig.com/256-colors-cheat-sheet
# Black
export COLOR_BLACK="\[\033[1m\033[38;5;240m\]"
# Red
export COLOR_RED="\[\033[1m\033[38;5;88m\]"
# Green
export COLOR_GREEN="\[\033[1m\033[38;5;65m\]"
# Yellow
export COLOR_YELLOW="\[\033[1m\033[38;5;142m\]"
# Blue
export COLOR_BLUE="\[\033[1m\033[38;5;24m\]"
# Magenta
export COLOR_MAGENTA="\[\033[1m\033[38;5;54m\]"
# Cyan
export COLOR_CYAN="\[\033[1m\033[38;5;110m\]"
# White
export COLOR_WHITE="\[\033[1m\033[38;5;250m\]"
# Pink
export COLOR_PINK="\[\033[1m\033[38;5;203m\]"
# Orange
export COLOR_ORANGE="\[\033[1m\033[38;5;209m\]"
# Font
export FONT_RESET="\[$(tput sgr0)\]"
export FONT_BOLD="\[$(tput bold)\]"

# https://emojipedia.org
# Some emojis need additional space add the end.
export EMOJI_DESKTOP_COMPUTER=$'\U0001F5A5\U000FE0F '
export EMOJI_CONTAINER=$'\U0001F4E6'
export EMOJI_VM=$'\U0001F5B2\U000FE0 '
export EMOJI_ROOT=$'\U0001F60E'

find_git_branch() {
  local branch
  if branch=$(git rev-parse --abbrev-ref HEAD 2> /dev/null)\
      && [[ -n "$branch" ]]; then
    if [[ "$branch" == "HEAD" ]]; then
      branch='detached*'
    fi
    git_branch=" ${GIT_BRANCH} $branch"
  else
    git_branch=""
  fi
}

find_git_dirty() {
  local status=$(git status --porcelain 2> /dev/null)
  if [[ "$status" != "" ]]; then
    git_dirty='*'
  else
    git_dirty=''
  fi
}

find_git_tag() {
    local tag
    if tag=$(git describe --tags --abbrev=0 2> /dev/null); then
        git_tag="$tag"
    else
        git_tag=""
    fi
}

PROMPT_COMMAND="find_git_branch; find_git_dirty; find_git_tag; $PROMPT_COMMAND"

# Customize PS1 for bash
# arg1 - user/host color
# arg2 - workspace color
# arg3 - time color
# arg5 - separator color
function custom_ps1() {
    local header="${EMOJI_DESKTOP_COMPUTER}"
    local prim_color=""
    local work_color=""
    local time_color=""
    local sep_color=""
    local machine="\h"
    if [ ${CONTAINER_ID+x} ]; then
        header="${EMOJI_CONTAINER}"
        machine="${CONTAINER_ID}"
    elif systemd-detect-virt --vm -q; then
        header=${EMOJI_VM}
    fi
    if [ "$EUID" -eq 0 ]; then
        header="${EMOJI_ROOT}${header}"
    fi
    if [ -n $1 ]; then
        prim_color="$1"
    fi
    if [ -n $2 ]; then
        work_color="$2"
    fi
    if [ -n $3 ]; then
        time_color="$3"
    fi
    if [ -n $4 ]; then
        sep_color="$4"
    fi
    export PS1="\
$prim_color$header \u \
$sep_color@$FONT_RESET \
$prim_color$machine \
$sep_color:$FONT_RESET \
$work_color\w \
\[$COLOR_CYAN\]\$git_branch\[$COLOR_RED\]\$git_dirty\[$FONT_RESET\] \
$sep_color>$FONT_RESET \
$time_color\T\
\n\
$sep_color$ $FONT_RESET"
}

